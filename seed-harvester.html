<link rel="import" href="../polymer/polymer.html">

<!-- syntax highlighting -->
<link rel="import" href="../syntax-highlight/syntax-highlight.html">

<!-- code editing -->
<link rel="import" href="../code-mirror/code-mirror.html">

<polymer-element name="seed-harvester" attributes="seed db progress">
  <template>
    <link rel="stylesheet" href="../bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="seed-harvester.css">

    <template if="{{ progress == 'loading' }}">
      <div class="alert alert-info">Loading&hellip;</div>
    </template>

    <!-- viewing -->
    <template if="{{ !editing }}">
      <div>
        <span class="pull-right label label-info
          label-type-{{ seed.language }}">{{ seed.language }}</span>

        <h3>Seeds</h3>

        <template if="{{ seed.data }}">
            <pre is="syntax-highlight" id="fetch"
                 language="{{ seed.language }}" content="{{ seed.data }}"></pre>
        </template>

        <template if="{{ db }}">
          <div>
            <button class="btn btn-primary" on-click="{{ openEditor }}">Edit seeds</button>
            <template if="{{ seed.data }}">
              <button type="submit" class="btn btn-primary" on-click="{{ plantSeeds }}">Plant seeds</button>
            </template>
          </div>
        </template>
      </div>
    </template>

    <!-- editing -->
    <template if="{{ editing }}">
      <form on-submit="{{ closeEditor }}">
        <div class="form-group">
          <label for="language">Type</label>

          <select id="language" value="{{ editing.language }}">
            <option value="csv">CSV</option>
            <option value="json">JSON</option>
            <option value="javascript">JavaScript</option>
            <option value="url">URL</option>
          </select>
        </div>

        <template if="{{ editing.language != 'url' }}">
          <div class="form-group">
              <code-mirror language="{{ editing.language }}" value="{{ editing.data }}"></code-mirror>
          </div>
        </template>

        <template if="{{ editing.language == 'url' }}">
          <!-- TODO: autocomplete/search -->
          <div class="form-group">
            <input type="url" class="form-control" value="{{ editing.url }}" placeholder="http://&hellip;">
          </div>
        </template>

        <div class="form-actions">
          <button type="button" class="btn btn-danger" on-click="{{ clearItems }}">Clear items</button>
          <button type="button" class="btn btn-danger" on-click="{{ cancelEditor }}">Cancel</button>
          <button type="submit" class="btn btn-primary" on-click="{{ saveSeeds }}">Plant seeds</button>
        </div>
      </form>
    </template>

    <template if="{{ error }}">
      <div class="alert alert-error">{{ error }}</div>
    </template>
  </template>

  <script src="seed-harvester.js"></script>
</polymer-element>
